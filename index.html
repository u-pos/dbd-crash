<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>マッチ3ゲーム</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
    margin: 0;
  }
  #game-container {
    display: grid;
    grid-template-columns: repeat(6, 60px);
    grid-template-rows: repeat(6, 60px);
    gap: 4px;
    margin-top: 20px;
    touch-action: none;
  }
  .cell {
    width: 60px;
    height: 60px;
    background-size: cover;
    background-position: center;
    border-radius: 8px;
    transition: transform 0.25s ease-in-out;
  }
  .disappearing {
    animation: pop-out 0.3s forwards;
  }
  @keyframes pop-out {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(0); opacity: 0; }
  }
  .falling {
    transition: transform 0.4s cubic-bezier(.34,1.56,.64,1);
  }
  #info {
    margin-top: 10px;
    font-size: 18px;
  }
</style>
</head>
<body>

<h1>マッチ3ゲーム</h1>
<div id="info">
  スコア: <span id="score">0</span> | 残り時間: <span id="time">60</span>秒
</div>
<div id="game-container"></div>

<audio id="swapSound" src="a.mp3"></audio>
<audio id="matchSound" src="b.mp3"></audio>
<audio id="startSound" src="c.mp3"></audio>

<script>
const rows = 6;
const cols = 6;
const images = [
  'img1.png', // 1
  'img2.png', // 2
  'img3.png', // 3
  'img4.png', // 4
  'img5.png', // 5
  'img6.png'  // 6
];
let board = [];
let score = 0;
let timeLeft = 60;
let firstCell = null;
let lockBoard = false;

const gameContainer = document.getElementById('game-container');
const scoreEl = document.getElementById('score');
const timeEl = document.getElementById('time');

const swapSound = document.getElementById('swapSound');
const matchSound = document.getElementById('matchSound');
const startSound = document.getElementById('startSound');

function initBoard() {
  board = [];
  gameContainer.innerHTML = '';
  for (let r = 0; r < rows; r++) {
    const row = [];
    for (let c = 0; c < cols; c++) {
      const type = Math.floor(Math.random() * images.length);
      row.push(type);
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.style.backgroundImage = `url(${images[type]})`;
      cell.dataset.row = r;
      cell.dataset.col = c;
      gameContainer.appendChild(cell);
    }
    board.push(row);
  }
}

function startGame() {
  score = 0;
  timeLeft = 60;
  scoreEl.textContent = score;
  timeEl.textContent = timeLeft;
  initBoard();
  startSound.play();
  const timer = setInterval(() => {
    timeLeft--;
    timeEl.textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timer);
      alert(`ゲーム終了！ スコア: ${score}`);
    }
  }, 1000);
}

function swapCells(cell1, cell2) {
  const r1 = +cell1.dataset.row;
  const c1 = +cell1.dataset.col;
  const r2 = +cell2.dataset.row;
  const c2 = +cell2.dataset.col;
  [board[r1][c1], board[r2][c2]] = [board[r2][c2], board[r1][c1]];
  cell1.style.backgroundImage = `url(${images[board[r1][c1]]})`;
  cell2.style.backgroundImage = `url(${images[board[r2][c2]]})`;
}

function findMatches() {
  const matches = [];
  // 横
  for (let r = 0; r < rows; r++) {
    let matchLength = 1;
    for (let c = 1; c < cols; c++) {
      if (board[r][c] === board[r][c - 1] && board[r][c] !== null) {
        matchLength++;
      } else {
        if (matchLength >= 3) {
          for (let k = 0; k < matchLength; k++) {
            matches.push({ r, c: c - 1 - k });
          }
        }
        matchLength = 1;
      }
    }
    if (matchLength >= 3) {
      for (let k = 0; k < matchLength; k++) {
        matches.push({ r, c: cols - 1 - k });
      }
    }
  }
  // 縦
  for (let c = 0; c < cols; c++) {
    let matchLength = 1;
    for (let r = 1; r < rows; r++) {
      if (board[r][c] === board[r - 1][c] && board[r][c] !== null) {
        matchLength++;
      } else {
        if (matchLength >= 3) {
          for (let k = 0; k < matchLength; k++) {
            matches.push({ r: r - 1 - k, c });
          }
        }
        matchLength = 1;
      }
    }
    if (matchLength >= 3) {
      for (let k = 0; k < matchLength; k++) {
        matches.push({ r: rows - 1 - k, c });
      }
    }
  }
  return matches;
}

function removeMatches(matches) {
  matches.forEach(pos => {
    const cell = document.querySelector(`.cell[data-row="${pos.r}